---
title: "Chapter 14: Working with logistic regression"
author: "Wang minjie"
date: "`r format(Sys.Date())`"
output:
  github_document
---


```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidybayes)
library(bayesplot)
library(rstan)
library(loo)
library(brms)
library(patchwork)

rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
theme_set(bayesplot::theme_default())
```


## 14.2 Logistic regression with interactions
```{r, message=FALSE, warning=FALSE}
wells <- read_csv("ROS-Examples/Arsenic/data/wells.csv")
glimpse(wells)
```




```{r, warning=FALSE, message=FALSE}
stan_program <- "
data {
  int<lower=0> N;
  int<lower=0> K;
  matrix[N, K] X;
  int<lower=0,upper=1> y[N];
}

parameters {
  vector[K] beta;
}

model {
  y ~ bernoulli_logit( X * beta);
}
"


stan_data <- wells %>% 
  tidybayes::compose_data(
    N = n,
    K = 4,
    y = switch,
    X = model.matrix(~ 1 + dist100 + arsenic + dist100:arsenic)
 	)

m14.3 <- stan(model_code = stan_program, data = stan_data)
```

## 14.2.1 Centering the input variables.
```{r}
wells <-
  wells %>% 
  mutate(c_dist100 = dist100 - mean(dist100),
         c_arsenic = arsenic - mean(arsenic))
```


```{r}
stan_data <- wells %>% 
  tidybayes::compose_data(
    N = n,
    K = 4,
    y = switch,
    X = model.matrix(~ 1 + c_dist100 + c_arsenic + c_dist100:c_arsenic)
 	)

m14.4 <- stan(model_code = stan_program, data = stan_data)
```

